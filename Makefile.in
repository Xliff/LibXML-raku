SRC=src

all : lib

lib : resources/libraries/%LIB-NAME%

# 'all', with compilation warnings and debug symbols enabled
debug :
	%MAKE% "DBG=-Wall -g"  all

resources/libraries/%LIB-NAME% : $(SRC)/dom%O% $(SRC)/domXPath%O% $(SRC)/xml6_parser_ctx%O%  $(SRC)/xml6_config%O% $(SRC)/xml6_doc%O% $(SRC)/xml6_entity%O% $(SRC)/xml6_gbl%O% $(SRC)/xml6_input%O% $(SRC)/xml6_node%O% $(SRC)/xml6_ns%O% $(SRC)/xml6_sax%O% $(SRC)/xml6_ref%O%  $(SRC)/xml6_reader%O% $(SRC)/xml6_xpath%O%
	%LD% %LDSHARED% %LDFLAGS% %LDOUT%resources/libraries/%LIB-NAME% \
        $(SRC)/dom%O%  $(SRC)/domXPath%O% $(SRC)/xml6_parser_ctx%O% $(SRC)/xml6_config%O% $(SRC)/xml6_doc%O% $(SRC)/xml6_entity%O% $(SRC)/xml6_gbl%O% $(SRC)/xml6_input%O% $(SRC)/xml6_node%O% $(SRC)/xml6_ns%O% $(SRC)/xml6_sax%O% $(SRC)/xml6_ref%O%  $(SRC)/xml6_reader%O% $(SRC)/xml6_xpath%O% \
        %LIB-LDFLAGS% 

$(SRC)/dom%O% : $(SRC)/dom.c $(SRC)/dom.h
	%CC% -I $(SRC) -c %CCSHARED% %CCFLAGS% %CCOUT%$(SRC)/dom%O% $(SRC)/dom.c %LIB-CFLAGS% $(DBG)

$(SRC)/domXPath%O% : $(SRC)/domXPath.c $(SRC)/domXPath.h
	%CC% -I $(SRC) -c %CCSHARED% %CCFLAGS% %CCOUT%$(SRC)/domXPath%O% $(SRC)/domXPath.c %LIB-CFLAGS% $(DBG)

$(SRC)/xml6_parser_ctx%O% : $(SRC)/xml6_parser_ctx.c $(SRC)/xml6_parser_ctx.h
	%CC% -I $(SRC) -c %CCSHARED% %CCFLAGS% %CCOUT%$(SRC)/xml6_parser_ctx%O% $(SRC)/xml6_parser_ctx.c %LIB-CFLAGS% $(DBG)

$(SRC)/xml6_config%O% : $(SRC)/xml6_config.c $(SRC)/xml6_config.h
	%CC% -I $(SRC) -c %CCSHARED% %CCFLAGS% %CCOUT%$(SRC)/xml6_config%O% $(SRC)/xml6_config.c %LIB-CFLAGS% $(DBG)

$(SRC)/xml6_doc%O% : $(SRC)/xml6_doc.c $(SRC)/xml6_doc.h
	%CC% -I $(SRC) -c %CCSHARED% %CCFLAGS% %CCOUT%$(SRC)/xml6_doc%O% $(SRC)/xml6_doc.c %LIB-CFLAGS% $(DBG)

$(SRC)/xml6_entity%O% : $(SRC)/xml6_entity.c $(SRC)/xml6_entity.h
	%CC% -I $(SRC) -c %CCSHARED% %CCFLAGS% %CCOUT%$(SRC)/xml6_entity%O% $(SRC)/xml6_entity.c %LIB-CFLAGS% $(DBG)

$(SRC)/xml6_gbl%O% : $(SRC)/xml6_gbl.c $(SRC)/xml6_gbl.h
	%CC% -I $(SRC) -c %CCSHARED% %CCFLAGS% %CCOUT%$(SRC)/xml6_gbl%O% $(SRC)/xml6_gbl.c %LIB-CFLAGS% $(DBG)

$(SRC)/xml6_input%O% : $(SRC)/xml6_input.c $(SRC)/xml6_input.h
	%CC% -I $(SRC) -c %CCSHARED% %CCFLAGS% %CCOUT%$(SRC)/xml6_input%O% $(SRC)/xml6_input.c %LIB-CFLAGS% $(DBG)

$(SRC)/xml6_node%O% : $(SRC)/xml6_node.c $(SRC)/xml6_node.h
	%CC% -I $(SRC) -c %CCSHARED% %CCFLAGS% %CCOUT%$(SRC)/xml6_node%O% $(SRC)/xml6_node.c %LIB-CFLAGS% $(DBG)

$(SRC)/xml6_ns%O% : $(SRC)/xml6_ns.c $(SRC)/xml6_ns.h
	%CC% -I $(SRC) -c %CCSHARED% %CCFLAGS% %CCOUT%$(SRC)/xml6_ns%O% $(SRC)/xml6_ns.c %LIB-CFLAGS% $(DBG)

$(SRC)/xml6_sax%O% : $(SRC)/xml6_sax.c $(SRC)/xml6_sax.h
	%CC% -I $(SRC) -c %CCSHARED% %CCFLAGS% %CCOUT%$(SRC)/xml6_sax%O% $(SRC)/xml6_sax.c %LIB-CFLAGS% $(DBG)

$(SRC)/xml6_ref%O% : $(SRC)/xml6_ref.c $(SRC)/xml6_ref.h
	%CC% -I $(SRC) -c %CCSHARED% %CCFLAGS% %CCOUT%$(SRC)/xml6_ref%O% $(SRC)/xml6_ref.c %LIB-CFLAGS% $(DBG)

$(SRC)/xml6_reader%O% : $(SRC)/xml6_reader.c $(SRC)/xml6_reader.h
	%CC% -I $(SRC) -c %CCSHARED% %CCFLAGS% %CCOUT%$(SRC)/xml6_reader%O% $(SRC)/xml6_reader.c %LIB-CFLAGS% $(DBG)

$(SRC)/xml6_xpath%O% : $(SRC)/xml6_xpath.c $(SRC)/xml6_xpath.h
	%CC% -I $(SRC) -c %CCSHARED% %CCFLAGS% %CCOUT%$(SRC)/xml6_xpath%O% $(SRC)/xml6_xpath.c %LIB-CFLAGS% $(DBG)

test : all
	@prove -e"perl6 -I ." t

loudtest : all
	@prove -e"perl6 -I ." -v t

xtest : all
	@prove -e"perl6 -I ." -r t xt

clean :
	@rm -f $(SRC)/xml6_*%O% $(SRC)/dom%O% $(SRC)/domXPath%O% resources/libraries/*%LIB-NAME%

realclean : clean
	@rm -f Makefile doc/*.md doc/*/*.md

doc : README.md doc/Attr.md doc/Attr/Map.md doc/CDATA.md doc/Comment.md doc/Config.md doc/Document.md doc/DocumentFragment.md\
      doc/Dtd.md doc/Element.md doc/ErrorHandling.md doc/InputCallback.md doc/Item.md doc/Namespace.md doc/Native.md\
      doc/Node.md doc/Node/List.md doc/Node/Set.md doc/PI.md doc/RelaxNG.md doc/Text.md doc/Pattern.md\
      doc/Parser.md doc/PushParser.md doc/RegExp.md doc/Reader.md doc/Schema.md doc/XPath/Context.md doc/XPath/Expression.md

README.md : lib/LibXML.rakumod
	(\
	    echo '[![Build Status](https://travis-ci.org/p6-xml/LibXML-raku.svg?branch=master)](https://travis-ci.org/p6-xml/LibXML-raku)'; \
            echo '';\
            perl6 -I . --doc=Markdown lib/LibXML.rakumod\
        ) > README.md

doc/Attr.md : lib/LibXML/Attr.rakumod
	perl6 -I . --doc=Markdown lib/LibXML/Attr.rakumod > doc/Attr.md

doc/Attr/Map.md : lib/LibXML/Attr/Map.rakumod
	perl6 -I . --doc=Markdown lib/LibXML/Attr/Map.rakumod > doc/Attr/Map.md

doc/Comment.md : lib/LibXML/Comment.rakumod
	perl6 -I . --doc=Markdown lib/LibXML/Comment.rakumod > doc/Comment.md

doc/Config.md : lib/LibXML/Config.rakumod
	perl6 -I . --doc=Markdown lib/LibXML/Config.rakumod > doc/Config.md

doc/CDATA.md : lib/LibXML/CDATA.rakumod
	perl6 -I . --doc=Markdown lib/LibXML/CDATA.rakumod > doc/CDATA.md

doc/Document.md : lib/LibXML/Document.rakumod
	perl6 -I . --doc=Markdown lib/LibXML/Document.rakumod > doc/Document.md

doc/DocumentFragment.md : lib/LibXML/DocumentFragment.rakumod
	perl6 -I . --doc=Markdown lib/LibXML/DocumentFragment.rakumod > doc/DocumentFragment.md

doc/Dtd.md : lib/LibXML/Dtd.rakumod
	perl6 -I . --doc=Markdown lib/LibXML/Dtd.rakumod > doc/Dtd.md

doc/Element.md : lib/LibXML/Element.rakumod
	perl6 -I . --doc=Markdown lib/LibXML/Element.rakumod > doc/Element.md

doc/ErrorHandling.md : lib/LibXML/ErrorHandling.rakumod
	perl6 -I . --doc=Markdown lib/LibXML/ErrorHandling.rakumod > doc/ErrorHandling.md

doc/InputCallback.md : lib/LibXML/InputCallback.rakumod
	perl6 -I . --doc=Markdown lib/LibXML/InputCallback.rakumod > doc/InputCallback.md

doc/Item.md : lib/LibXML/Item.rakumod
	perl6 -I . --doc=Markdown lib/LibXML/Item.rakumod > doc/Item.md

doc/Namespace.md : lib/LibXML/Namespace.rakumod
	perl6 -I . --doc=Markdown lib/LibXML/Namespace.rakumod > doc/Namespace.md

doc/Native.md : lib/LibXML/Native.rakumod
	perl6 -I . --doc=Markdown lib/LibXML/Native.rakumod > doc/Native.md

doc/Node.md : lib/LibXML/Node.rakumod
	perl6 -I . --doc=Markdown lib/LibXML/Node.rakumod > doc/Node.md

doc/Node/List.md : lib/LibXML/Node/List.rakumod
	perl6 -I . --doc=Markdown lib/LibXML/Node/List.rakumod > doc/Node/List.md

doc/Node/Set.md : lib/LibXML/Node/Set.rakumod
	perl6 -I . --doc=Markdown lib/LibXML/Node/Set.rakumod > doc/Node/Set.md

doc/PI.md : lib/LibXML/PI.rakumod
	perl6 -I . --doc=Markdown lib/LibXML/PI.rakumod > doc/PI.md

doc/Parser.md : lib/LibXML/Parser.rakumod
	perl6 -I . --doc=Markdown lib/LibXML/Parser.rakumod > doc/Parser.md

doc/PushParser.md : lib/LibXML/PushParser.rakumod
	perl6 -I . --doc=Markdown lib/LibXML/PushParser.rakumod > doc/PushParser.md

doc/Pattern.md : lib/LibXML/Pattern.rakumod
	perl6 -I . --doc=Markdown lib/LibXML/Pattern.rakumod > doc/Pattern.md

doc/RegExp.md : lib/LibXML/RegExp.rakumod
	perl6 -I . --doc=Markdown lib/LibXML/RegExp.rakumod > doc/RegExp.md

doc/Reader.md : lib/LibXML/Reader.rakumod
	perl6 -I . --doc=Markdown lib/LibXML/Reader.rakumod > doc/Reader.md

doc/Schema.md : lib/LibXML/Schema.rakumod
	perl6 -I . --doc=Markdown lib/LibXML/Schema.rakumod > doc/Schema.md

doc/RelaxNG.md : lib/LibXML/RelaxNG.rakumod
	perl6 -I . --doc=Markdown lib/LibXML/RelaxNG.rakumod > doc/RelaxNG.md

doc/Text.md : lib/LibXML/Text.rakumod
	perl6 -I . --doc=Markdown lib/LibXML/Text.rakumod > doc/Text.md

doc/XPath/Context.md : lib/LibXML/XPath/Context.rakumod
	perl6 -I . --doc=Markdown lib/LibXML/XPath/Context.rakumod > doc/XPath/Context.md

doc/XPath/Expression.md : lib/LibXML/XPath/Expression.rakumod
	perl6 -I . --doc=Markdown lib/LibXML/XPath/Expression.rakumod > doc/XPath/Expression.md

